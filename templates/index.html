<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒ¥ã‚¨ãƒ«ãƒã‚¹ã‚¿ãƒ¼ã‚º</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            overflow-x: hidden;
        }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .header h1 {
            font-size: 36px;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
            margin-bottom: 10px;
        }
        
        /* ãƒ«ãƒ¼ãƒ è¨­å®š */
        .room-setup {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            margin: 50px auto;
            text-align: center;
        }
        
        .room-setup input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ffcc00;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }
        
        .room-setup button {
            width: 48%;
            padding: 12px;
            margin: 5px 1%;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            color: #000;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .room-setup button:hover {
            transform: scale(1.05);
        }
        
        /* ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
        .game-field {
            display: none;
        }
        
        .game-field.active {
            display: block;
        }
        
        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ */
        .player-area {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border: 3px solid;
        }
        
        .player-area.p1 { border-color: #3498db; }
        .player-area.p2 { border-color: #e74c3c; }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
        }
        
        .player-name {
            font-size: 24px;
            font-weight: bold;
        }
        
        .shields {
            display: flex;
            gap: 5px;
        }
        
        .shield {
            width: 30px;
            height: 40px;
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            border: 2px solid #fff;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        /* ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³ */
        .battle-zone {
            min-height: 200px;
            background: rgba(50, 50, 50, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }
        
        .battle-zone h3 {
            width: 100%;
            margin-bottom: 10px;
            color: #ffcc00;
        }
        
        /* ãƒãƒŠã‚¾ãƒ¼ãƒ³ */
        .mana-zone {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            background: rgba(0, 100, 0, 0.2);
            border-radius: 8px;
            min-height: 80px;
            margin: 10px 0;
        }
        
        /* æ‰‹æœ­ã‚¨ãƒªã‚¢ */
        .hand-area {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            min-height: 200px;
        }
        
        .hand-area h3 {
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .hand-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        /* ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .card {
            width: 120px;
            height: 180px;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            border: 3px solid;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }
        
        .card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
        }
        
        .card.fire {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            border-color: #ff0000;
        }
        
        .card.water {
            background: linear-gradient(135deg, #4444ff 0%, #0000cc 100%);
            border-color: #0000ff;
        }
        
        .card.nature {
            background: linear-gradient(135deg, #44ff44 0%, #00cc00 100%);
            border-color: #00ff00;
        }
        
        .card.light {
            background: linear-gradient(135deg, #ffff44 0%, #cccc00 100%);
            border-color: #ffff00;
        }
        
        .card.darkness {
            background: linear-gradient(135deg, #8844ff 0%, #4400cc 100%);
            border-color: #6600ff;
        }
        
        /* å¤šè‰²ã‚«ãƒ¼ãƒ‰ */
        .card.multi {
            background: linear-gradient(135deg, #ff4444 0%, #4444ff 25%, #44ff44 50%, #ffff44 75%, #8844ff 100%);
            border-color: #ffaa00;
            box-shadow: 0 0 15px rgba(255, 170, 0, 0.6);
        }
        
        .card.multi-fire-darkness {
            background: linear-gradient(135deg, #ff4444 0%, #8844ff 100%);
            border-color: #ff0088;
        }
        
        .card.multi-light-water {
            background: linear-gradient(135deg, #ffff44 0%, #4444ff 100%);
            border-color: #88ffff;
        }
        
        .card.multi-light-nature {
            background: linear-gradient(135deg, #ffff44 0%, #44ff44 100%);
            border-color: #ccff00;
        }
        
        .card-cost {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 35px;
            height: 35px;
            background: #ffcc00;
            border: 3px solid #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .card-name {
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            margin-bottom: 5px;
            text-align: center;
        }
        
        .card-race {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            margin-bottom: 5px;
        }
        
        .card-ability {
            font-size: 8px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px;
            border-radius: 5px;
            height: 70px;
            overflow-y: auto;
            margin: 5px 0;
        }
        
        .card-power {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }
        
        .card.tapped {
            transform: rotate(90deg);
            opacity: 0.7;
        }
        
        .card.summoning-sick {
            opacity: 0.6;
            filter: grayscale(0.5);
        }
        
        /* ãƒãƒŠã‚«ãƒ¼ãƒ‰ï¼ˆå°ã•ãè¡¨ç¤ºï¼‰ */
        .mana-card {
            width: 40px;
            height: 60px;
            border-radius: 5px;
            border: 2px solid;
            position: relative;
            transition: transform 0.2s;
        }
        
        .mana-card:hover {
            transform: scale(1.2);
        }
        
        .mana-card.tapped {
            opacity: 0.5;
        }
        
        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .controls {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .controls button {
            padding: 12px 25px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-charge {
            background: linear-gradient(135deg, #44ff44, #00cc00);
            color: #000;
        }
        
        .btn-summon {
            background: linear-gradient(135deg, #4444ff, #0000cc);
            color: white;
        }
        
        .btn-spell {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
        }
        
        .btn-attack {
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            color: #000;
        }
        
        .btn-end {
            background: linear-gradient(135deg, #888888, #555555);
            color: white;
        }
        
        .controls button:hover {
            transform: scale(1.1);
        }
        
        .controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ãƒ­ã‚°ã‚¨ãƒªã‚¢ */
        .log-area {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .log-area h3 {
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .log-entry {
            padding: 5px;
            border-left: 3px solid #ffcc00;
            margin: 5px 0;
            padding-left: 10px;
            color: #fff;
        }
        
        /* ã‚¿ãƒ¼ãƒ³è¡¨ç¤º */
        .turn-indicator {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            border-radius: 10px;
            margin: 10px 0;
            font-size: 24px;
            font-weight: bold;
            color: #000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }
        
        /* å‹åˆ©è¡¨ç¤º */
        .winner-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            z-index: 1000;
            border: 5px solid #ffcc00;
            display: none;
        }
        
        .winner-display.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        
        .winner-display h2 {
            font-size: 48px;
            color: #ffcc00;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 204, 0, 0.8);
        }
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }
        
        ::-webkit-scrollbar-thumb {
            background: #ffcc00;
            border-radius: 4px;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .card {
                width: 90px;
                height: 135px;
            }
            
            .controls button {
                padding: 8px 15px;
                font-size: 14px;
            }
        }
        
        .selected-card {
            border: 4px solid #ffcc00 !important;
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.8) !important;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .stat-label {
            color: #ffcc00;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>âš”ï¸ ãƒ‡ãƒ¥ã‚¨ãƒ«ãƒã‚¹ã‚¿ãƒ¼ã‚º âš”ï¸</h1>
            <p>ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã®ä¸–ç•Œã¸ã‚ˆã†ã“ãï¼</p>
        </div>
        
        <!-- ãƒ«ãƒ¼ãƒ è¨­å®šç”»é¢ -->
        <div class="room-setup" id="roomSetup">
            <h2>ãƒ«ãƒ¼ãƒ è¨­å®š</h2>
            
            <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åè¨­å®š -->
            <input type="text" id="playerNameInput" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›">
            <button onclick="savePlayerName()" style="width: 100%; margin-bottom: 20px;">åå‰ã‚’ä¿å­˜</button>
            <div id="savedNameDisplay" style="margin-bottom: 20px; color: #4CAF50;"></div>
            
            <input type="text" id="roomIdInput" placeholder="ãƒ«ãƒ¼ãƒ IDï¼ˆç©ºæ¬„ã§è‡ªå‹•ç”Ÿæˆï¼‰">
            <div>
                <button onclick="createRoom()">ãƒ«ãƒ¼ãƒ ä½œæˆ</button>
                <button onclick="joinRoom()">ãƒ«ãƒ¼ãƒ å‚åŠ </button>
            </div>
            <div id="roomInfo" style="margin-top: 20px; color: #ffcc00;"></div>
            <button id="readyBtn" onclick="ready()" style="width: 100%; margin-top: 20px; display: none;">æº–å‚™å®Œäº†</button>
        </div>
        
        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div class="game-field" id="gameField">
            <!-- ã‚¿ãƒ¼ãƒ³è¡¨ç¤º -->
            <div class="turn-indicator" id="turnIndicator">
                ã‚¿ãƒ¼ãƒ³1: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ã‚¿ãƒ¼ãƒ³
            </div>
            
            <!-- ç›¸æ‰‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div class="player-area p2" id="opponentArea">
                <div class="player-info">
                    <span class="player-name">ç›¸æ‰‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</span>
                    <div class="shields" id="opponentShields"></div>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-label">ãƒ‡ãƒƒã‚­:</span>
                            <span id="opponentDeckCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">æ‰‹æœ­:</span>
                            <span id="opponentHandCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ãƒãƒŠ:</span>
                            <span id="opponentManaCount">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="mana-zone" id="opponentMana">
                    <small style="width: 100%; color: #ffcc00;">ãƒãƒŠã‚¾ãƒ¼ãƒ³</small>
                </div>
                
                <div class="battle-zone" id="opponentBattleZone">
                    <h3>ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³</h3>
                </div>
            </div>
            
            <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <div class="controls">
                <button class="btn-charge" onclick="chargeMode()" id="chargeBtn">ãƒãƒŠãƒãƒ£ãƒ¼ã‚¸</button>
                <button class="btn-summon" onclick="summonMode()" id="summonBtn">å¬å–š</button>
                <button class="btn-spell" onclick="spellMode()" id="spellBtn">å‘ªæ–‡</button>
                <button class="btn-attack" onclick="attackMode()" id="attackBtn">æ”»æ’ƒ</button>
                <button class="btn-end" onclick="endTurn()" id="endTurnBtn">ã‚¿ãƒ¼ãƒ³çµ‚äº†</button>
            </div>
            
            <!-- è‡ªåˆ†ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div class="player-area p1" id="playerArea">
                <div class="battle-zone" id="playerBattleZone">
                    <h3>ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³</h3>
                </div>
                
                <div class="mana-zone" id="playerMana">
                    <small style="width: 100%; color: #ffcc00;">ãƒãƒŠã‚¾ãƒ¼ãƒ³</small>
                </div>
                
                <div class="player-info">
                    <span class="player-name">ã‚ãªãŸ</span>
                    <div class="shields" id="playerShields"></div>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-label">ãƒ‡ãƒƒã‚­:</span>
                            <span id="playerDeckCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">æ‰‹æœ­:</span>
                            <span id="playerHandCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ãƒãƒŠ:</span>
                            <span id="playerManaCount">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ‰‹æœ­ -->
            <div class="hand-area">
                <h3>æ‰‹æœ­</h3>
                <div class="hand-cards" id="playerHand"></div>
            </div>
            
            <!-- ãƒ­ã‚° -->
            <div class="log-area">
                <h3>ã‚²ãƒ¼ãƒ ãƒ­ã‚°</h3>
                <div id="gameLog"></div>
            </div>
        </div>
        
        <!-- å‹åˆ©è¡¨ç¤º -->
        <div class="winner-display" id="winnerDisplay">
            <h2>ğŸ† å‹åˆ©ï¼ ğŸ†</h2>
            <p style="font-size: 24px; color: white;">ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</p>
            <button onclick="location.reload()" style="margin-top: 20px; padding: 15px 30px; font-size: 18px;">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
        </div>
    </div>
    
    <script>
        const socket = io();
        let myPlayer = null;
        let roomId = null;
        let gameState = null;
        let currentMode = null;
        let selectedCard = null;
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¿å­˜ã•ã‚ŒãŸåå‰ã‚’è¡¨ç¤º
        window.onload = function() {
            loadPlayerName();
        };

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’ä¿å­˜
        function savePlayerName() {
            const nameInput = document.getElementById('playerNameInput');
            const name = nameInput.value.trim();
            if (name) {
                localStorage.setItem('duel_masters_player_name', name);
                displaySavedName(name);
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            } else {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            }
        }

        // ä¿å­˜ã•ã‚ŒãŸåå‰ã‚’èª­ã¿è¾¼ã¿
        function loadPlayerName() {
            const savedName = localStorage.getItem('duel_masters_player_name');
            if (savedName) {
                document.getElementById('playerNameInput').value = savedName;
                displaySavedName(savedName);
            }
        }

        // ä¿å­˜ã•ã‚ŒãŸåå‰ã‚’è¡¨ç¤º
        function displaySavedName(name) {
            document.getElementById('savedNameDisplay').textContent = `ä¿å­˜æ¸ˆã¿: ${name}`;
        }
        
        // ãƒ«ãƒ¼ãƒ ä½œæˆ
        function createRoom() {
            const input = document.getElementById('roomIdInput').value;
            socket.emit('create_room', { room_id: input || undefined });
        }
        
        // ãƒ«ãƒ¼ãƒ å‚åŠ 
        function joinRoom() {
            const input = document.getElementById('roomIdInput').value;
            if (!input) {
                alert('ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            socket.emit('join_room', { room_id: input });
        }
        
        // æº–å‚™å®Œäº†
        function ready() {
            socket.emit('ready', { player: myPlayer });
            document.getElementById('readyBtn').disabled = true;
            document.getElementById('roomInfo').innerHTML += '<br>æº–å‚™å®Œäº†ï¼ç›¸æ‰‹ã‚’å¾…ã£ã¦ã„ã¾ã™...';
        }
        
        // ãƒãƒŠãƒãƒ£ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰
        function chargeMode() {
            currentMode = 'charge';
            selectedCard = null;
            updateButtonStates();
        }
        
        // å¬å–šãƒ¢ãƒ¼ãƒ‰
        function summonMode() {
            currentMode = 'summon';
            selectedCard = null;
            updateButtonStates();
        }
        
        // å‘ªæ–‡ãƒ¢ãƒ¼ãƒ‰
        function spellMode() {
            currentMode = 'spell';
            selectedCard = null;
            updateButtonStates();
        }
        
        // æ”»æ’ƒãƒ¢ãƒ¼ãƒ‰
        function attackMode() {
            currentMode = 'attack';
            selectedCard = null;
            updateButtonStates();
        }
        
        // ã‚¿ãƒ¼ãƒ³çµ‚äº†
        function endTurn() {
            socket.emit('end_turn', { player: myPlayer });
            currentMode = null;
            selectedCard = null;
        }
        
        // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯
        function onCardClick(card, location) {
            if (gameState.turn !== myPlayer) return;
            
            if (currentMode === 'charge' && location === 'hand') {
                socket.emit('charge_mana', { player: myPlayer, card_id: card.id });
                currentMode = null;
            } else if (currentMode === 'summon' && location === 'hand' && card.type === 'creature') {
                socket.emit('summon_creature', { player: myPlayer, card_id: card.id });
                currentMode = null;
            } else if (currentMode === 'spell' && location === 'hand' && card.type === 'spell') {
                socket.emit('cast_spell', { player: myPlayer, card_id: card.id });
                currentMode = null;
            } else if (currentMode === 'attack' && location === 'battle') {
                socket.emit('attack', { player: myPlayer, creature_id: card.id, target: 'player' });
            }
            
            updateButtonStates();
        }
        
        // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
        function updateButtonStates() {
            const buttons = ['chargeBtn', 'summonBtn', 'spellBtn', 'attackBtn'];
            buttons.forEach(id => {
                document.getElementById(id).style.opacity = '1';
            });
            
            if (currentMode) {
                const activeBtn = currentMode + 'Btn';
                buttons.forEach(id => {
                    if (id !== activeBtn) {
                        document.getElementById(id).style.opacity = '0.5';
                    }
                });
            }
        }
        
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ç”»é¢ã«åæ˜ 
        function updateGameDisplay() {
            if (!gameState) return;
            
            const myData = gameState.players[myPlayer];
            const opData = gameState.players[myPlayer === 'p1' ? 'p2' : 'p1'];
            
            // ã‚¿ãƒ¼ãƒ³è¡¨ç¤º
            document.getElementById('turnIndicator').innerText = 
                `ã‚¿ãƒ¼ãƒ³${gameState.turn_count}: ${gameState.turn === myPlayer ? 'ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³' : 'ç›¸æ‰‹ã®ã‚¿ãƒ¼ãƒ³'}`;
            
            // ã‚·ãƒ¼ãƒ«ãƒ‰è¡¨ç¤º
            updateShields('playerShields', myData.shields);
            updateShields('opponentShields', opData.shields);
            
            // çµ±è¨ˆ
            document.getElementById('playerDeckCount').innerText = myData.deck_count;
            document.getElementById('playerHandCount').innerText = myData.hand_count;
            document.getElementById('playerManaCount').innerText = myData.mana.length;
            document.getElementById('opponentDeckCount').innerText = opData.deck_count;
            document.getElementById('opponentHandCount').innerText = opData.hand_count;
            document.getElementById('opponentManaCount').innerText = opData.mana.length;
            
            // æ‰‹æœ­
            updateHand(myData.hand);
            
            // ãƒãƒŠã‚¾ãƒ¼ãƒ³
            updateMana('playerMana', myData.mana);
            updateMana('opponentMana', opData.mana);
            
            // ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³
            updateBattleZone('playerBattleZone', myData.battle_zone, myPlayer);
            updateBattleZone('opponentBattleZone', opData.battle_zone, myPlayer === 'p1' ? 'p2' : 'p1');
            
            // ãƒ­ã‚°
            updateLog(gameState.log);
            
            // å‹åˆ©åˆ¤å®š
            if (gameState.winner) {
                if (gameState.winner === myPlayer) {
                    document.getElementById('winnerDisplay').classList.add('show');
                } else {
                    document.getElementById('winnerDisplay').innerHTML = 
                        '<h2>ğŸ˜¢ æ•—åŒ— ğŸ˜¢</h2><p style="font-size: 24px; color: white;">æ¬¡ã¯é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼</p>';
                    document.getElementById('winnerDisplay').classList.add('show');
                }
            }
        }
        
        // ã‚·ãƒ¼ãƒ«ãƒ‰è¡¨ç¤º
        function updateShields(elementId, count) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const shield = document.createElement('div');
                shield.className = 'shield';
                shield.innerText = 'S';
                container.appendChild(shield);
            }
        }
        
        // æ‰‹æœ­è¡¨ç¤º
        function updateHand(hand) {
            const container = document.getElementById('playerHand');
            container.innerHTML = '';
            hand.forEach(card => {
                container.appendChild(createCardElement(card, 'hand'));
            });
        }
        
        // ãƒãƒŠã‚¾ãƒ¼ãƒ³è¡¨ç¤º
        function updateMana(elementId, mana) {
            const container = document.getElementById(elementId);
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä¿æŒ
            const header = container.querySelector('small');
            container.innerHTML = '';
            if (header) container.appendChild(header);
            
            mana.forEach(card => {
                const manaCard = document.createElement('div');
                let civClass = '';
                if (Array.isArray(card.civ)) {
                    civClass = card.civ[0];
                } else {
                    civClass = card.civ || card.civ_display || 'fire';
                }
                manaCard.className = `mana-card ${civClass} ${card.tapped ? 'tapped' : ''}`;
                manaCard.title = card.name;
                container.appendChild(manaCard);
            });
        }
        
        // ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³è¡¨ç¤º
        function updateBattleZone(elementId, creatures, owner) {
            const container = document.getElementById(elementId);
            const header = container.querySelector('h3');
            container.innerHTML = '';
            if (header) container.appendChild(header);
            
            creatures.forEach(creature => {
                container.appendChild(createCardElement(creature, 'battle', owner));
            });
        }
        
        // ã‚«ãƒ¼ãƒ‰è¦ç´ ä½œæˆ
        function createCardElement(card, location, owner) {
            const cardDiv = document.createElement('div');
            
            // å¤šè‰²ã‚«ãƒ¼ãƒ‰å¯¾å¿œ
            let civClass = '';
            if (Array.isArray(card.civ)) {
                if (card.civ.length > 2) {
                    civClass = 'multi';
                } else {
                    civClass = `multi-${card.civ.join('-')}`;
                }
            } else {
                civClass = card.civ || card.civ_display || 'fire';
            }
            
            cardDiv.className = `card ${civClass}`;
            if (card.tapped) cardDiv.classList.add('tapped');
            if (card.summoning_sick) cardDiv.classList.add('summoning-sick');
            
            cardDiv.onclick = () => onCardClick(card, location);
            
            // Sãƒ»ãƒˆãƒªã‚¬ãƒ¼ãƒãƒ¼ã‚¯
            const triggerMark = card.shield_trigger ? '<span style="color: #ffcc00; font-weight: bold;">âš¡Sãƒ»ãƒˆãƒªã‚¬ãƒ¼</span><br>' : '';
            
            // ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼è¡¨ç¤º
            let breakerText = '';
            if (card.breaker && card.breaker > 1) {
                breakerText = `<div style="position: absolute; top: -8px; right: -8px; background: #ff0000; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid #fff;">${'âš”ï¸'.repeat(card.breaker)}</div>`;
            }
            
            cardDiv.innerHTML = `
                <div class="card-cost">${card.cost}</div>
                ${breakerText}
                <div class="card-name">${card.name}</div>
                <div class="card-race">${card.race || card.type}</div>
                <div class="card-ability">${triggerMark}${card.ability || 'åŠ¹æœãªã—'}</div>
                ${card.type === 'creature' ? `<div class="card-power">${card.power}</div>` : ''}
            `;
            
            return cardDiv;
        }
        
        // ãƒ­ã‚°æ›´æ–°
        function updateLog(log) {
            const container = document.getElementById('gameLog');
            container.innerHTML = '';
            log.forEach(entry => {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerText = entry;
                container.appendChild(logEntry);
            });
            container.scrollTop = container.scrollHeight;
        }
        
        // Socket.IOã‚¤ãƒ™ãƒ³ãƒˆ
        socket.on('room_created', (data) => {
            roomId = data.room_id;
            myPlayer = data.player;
            document.getElementById('roomInfo').innerHTML = `ãƒ«ãƒ¼ãƒ ID: <strong>${roomId}</strong><br>ã‚ãªãŸã¯${myPlayer}ã§ã™`;
            document.getElementById('readyBtn').style.display = 'block';
        });
        
        socket.on('room_joined', (data) => {
            roomId = data.room_id;
            myPlayer = data.player;
            document.getElementById('roomInfo').innerHTML = `ãƒ«ãƒ¼ãƒ ID: <strong>${roomId}</strong><br>ã‚ãªãŸã¯${myPlayer}ã§ã™`;
            document.getElementById('readyBtn').style.display = 'block';
        });
        
        socket.on('game_start', (data) => {
            gameState = data;
            document.getElementById('roomSetup').style.display = 'none';
            document.getElementById('gameField').classList.add('active');
            updateGameDisplay();
        });
        
        socket.on('game_update', (data) => {
            gameState = data;
            updateGameDisplay();
        });
        
        socket.on('error', (data) => {
            alert(data.msg);
        });
    </script>
</body>
</html>
