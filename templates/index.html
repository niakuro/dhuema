<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒ¥ã‚¨ãƒ«ãƒã‚¹ã‚¿ãƒ¼ã‚º</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            overflow-x: hidden;
        }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .header h1 {
            font-size: 36px;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
            margin-bottom: 10px;
        }
        
        /* ãƒ«ãƒ¼ãƒ è¨­å®š */
        .room-setup {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            margin: 50px auto;
            text-align: center;
        }
        
        .room-setup input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ffcc00;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }
        
        .room-setup button {
            width: 48%;
            padding: 12px;
            margin: 5px 1%;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            color: #000;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .room-setup button:hover {
            transform: scale(1.05);
        }
        
        /* ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
        .game-field {
            display: none;
        }
        
        .game-field.active {
            display: block;
        }
        
        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ */
        .player-area {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border: 3px solid;
        }
        
        .player-area.p1 { border-color: #3498db; }
        .player-area.p2 { border-color: #e74c3c; }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
        }
        
        .player-name {
            font-size: 24px;
            font-weight: bold;
        }
        
        .shields {
            display: flex;
            gap: 5px;
        }
        
        .shield {
            width: 30px;
            height: 40px;
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            border: 2px solid #fff;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        /* ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³ */
        .battle-zone {
            min-height: 200px;
            background: rgba(50, 50, 50, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }
        
        .battle-zone h3 {
            width: 100%;
            margin-bottom: 10px;
            color: #ffcc00;
        }
        
        /* ãƒãƒŠã‚¾ãƒ¼ãƒ³ */
        .mana-zone {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            background: rgba(0, 100, 0, 0.2);
            border-radius: 8px;
            min-height: 80px;
            margin: 10px 0;
        }
        
        /* æ‰‹æœ­ã‚¨ãƒªã‚¢ */
        .hand-area {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            min-height: 200px;
        }
        
        .hand-area h3 {
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .hand-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        /* ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .card {
            width: 120px;
            height: 180px;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            border: 3px solid;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }
        
        .card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
        }
        
        .card.fire {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            border-color: #ff0000;
        }
        
        .card.water {
            background: linear-gradient(135deg, #4444ff 0%, #0000cc 100%);
            border-color: #0000ff;
        }
        
        .card.nature {
            background: linear-gradient(135deg, #44ff44 0%, #00cc00 100%);
            border-color: #00ff00;
        }
        
        .card.light {
            background: linear-gradient(135deg, #ffff44 0%, #cccc00 100%);
            border-color: #ffff00;
        }
        
        .card.darkness {
            background: linear-gradient(135deg, #8844ff 0%, #4400cc 100%);
            border-color: #6600ff;
        }
        
        /* å¤šè‰²ã‚«ãƒ¼ãƒ‰ */
        .card.multi {
            background: linear-gradient(135deg, #ff4444 0%, #4444ff 25%, #44ff44 50%, #ffff44 75%, #8844ff 100%);
            border-color: #ffaa00;
            box-shadow: 0 0 15px rgba(255, 170, 0, 0.6);
        }
        
        .card.multi-fire-darkness {
            background: linear-gradient(135deg, #ff4444 0%, #8844ff 100%);
            border-color: #ff0088;
        }
        
        .card.multi-light-water {
            background: linear-gradient(135deg, #ffff44 0%, #4444ff 100%);
            border-color: #88ffff;
        }
        
        .card.multi-light-nature {
            background: linear-gradient(135deg, #ffff44 0%, #44ff44 100%);
            border-color: #ccff00;
        }
        
        .card-cost {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 35px;
            height: 35px;
            background: #ffcc00;
            border: 3px solid #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .card-name {
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            margin-bottom: 5px;
            text-align: center;
        }
        
        .card-race {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            margin-bottom: 5px;
        }
        
        .card-ability {
            font-size: 8px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px;
            border-radius: 5px;
            height: 70px;
            overflow-y: auto;
            margin: 5px 0;
        }
        
        .card-power {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }
        
        .card.tapped {
            transform: rotate(90deg);
            opacity: 0.7;
        }
        
        .card.summoning-sick {
            opacity: 0.6;
            filter: grayscale(0.5);
        }
        
        /* ãƒãƒŠã‚«ãƒ¼ãƒ‰ï¼ˆå°ã•ãè¡¨ç¤ºï¼‰ */
        .mana-card {
            width: 40px;
            height: 60px;
            border-radius: 5px;
            border: 2px solid;
            position: relative;
            transition: transform 0.2s;
        }
        
        .mana-card:hover {
            transform: scale(1.2);
        }
        
        .mana-card.tapped {
            opacity: 0.5;
        }
        
        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .controls {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .controls button {
            padding: 12px 25px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-charge {
            background: linear-gradient(135deg, #44ff44, #00cc00);
            color: #000;
        }
        
        .btn-summon {
            background: linear-gradient(135deg, #4444ff, #0000cc);
            color: white;
        }
        
        .btn-spell {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
        }
        
        .btn-attack {
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            color: #000;
        }
        
        .btn-end {
            background: linear-gradient(135deg, #888888, #555555);
            color: white;
        }
        
        .controls button:hover {
            transform: scale(1.1);
        }
        
        .controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ãƒ­ã‚°ã‚¨ãƒªã‚¢ */
        .log-area {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .log-area h3 {
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .log-entry {
            padding: 5px;
            border-left: 3px solid #ffcc00;
            margin: 5px 0;
            padding-left: 10px;
            color: #fff;
        }
        
        /* ã‚¿ãƒ¼ãƒ³è¡¨ç¤º */
        .turn-indicator {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            border-radius: 10px;
            margin: 10px 0;
            font-size: 24px;
            font-weight: bold;
            color: #000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }
        
        /* å‹åˆ©è¡¨ç¤º */
        .winner-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            z-index: 1000;
            border: 5px solid #ffcc00;
            display: none;
        }
        
        .winner-display.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        
        .winner-display h2 {
            font-size: 48px;
            color: #ffcc00;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 204, 0, 0.8);
        }
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }
        
        ::-webkit-scrollbar-thumb {
            background: #ffcc00;
            border-radius: 4px;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .card {
                width: 90px;
                height: 135px;
            }
            
            .controls button {
                padding: 8px 15px;
                font-size: 14px;
            }
        }
        
        .selected-card {
            border: 4px solid #ffcc00 !important;
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.8) !important;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .stat-label {
            color: #ffcc00;
            font-weight: bold;
        }
        
        /* ã‚«ãƒ¼ãƒ‰è©³ç´°è¡¨ç¤º */
        .card-detail-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 300px;
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #ffcc00;
            border-radius: 15px;
            padding: 20px;
            display: none;
            z-index: 1000;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.8);
        }
        
        .card-detail-panel.show {
            display: block;
        }
        
        .card-detail-name {
            font-size: 22px;
            font-weight: bold;
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .card-detail-info {
            margin: 5px 0;
            font-size: 14px;
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-overlay.show {
            display: flex;
        }
        
        .modal-content {
            background: rgba(20, 20, 40, 0.98);
            border: 3px solid #ffcc00;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 30px;
            color: #ffcc00;
            cursor: pointer;
            background: none;
            border: none;
        }
        
        .modal-title {
            font-size: 24px;
            color: #ffcc00;
            margin-bottom: 20px;
        }
        
        .card-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }
        
        /* ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã‚¨ãƒªã‚¢ */
        .clickable {
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .clickable:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>âš”ï¸ ãƒ‡ãƒ¥ã‚¨ãƒ«ãƒã‚¹ã‚¿ãƒ¼ã‚º âš”ï¸</h1>
            <p>ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã®ä¸–ç•Œã¸ã‚ˆã†ã“ãï¼</p>
        </div>
        
        <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
        <div class="room-setup" id="titleScreen">
            <h1 style="font-size: 48px; color: #ffcc00; margin-bottom: 30px;">ãƒ‡ãƒ¥ã‚¨ãƒ«ãƒã‚¹ã‚¿ãƒ¼ã‚º</h1>
            <button id="startGameBtn" onclick="startNewGame()" style="width: 100%; display: none;">ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹</button>
            <button id="continueGameBtn" onclick="continueGame()" style="width: 100%; display: none;">ã‚²ãƒ¼ãƒ ã‚’ç¶šã‘ã‚‹</button>
        </div>
        
        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åè¨­å®šç”»é¢ -->
        <div class="room-setup" id="nameSetupScreen" style="display: none;">
            <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’è¨­å®š</h2>
            <input type="text" id="newPlayerNameInput" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›" style="margin: 20px 0;">
            <button onclick="confirmPlayerName()" style="width: 100%;">æ±ºå®š</button>
        </div>
        
        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ -->
        <div class="room-setup" id="menuScreen" style="display: none;">
            <h2>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
            <div id="menuPlayerName" style="margin-bottom: 20px; font-size: 20px; color: #4CAF50;"></div>
            
            <button onclick="showDeckBuilder()" style="width: 100%; margin: 10px 0; padding: 20px; font-size: 18px;">
                ğŸ“‹ ãƒ‡ãƒƒã‚­ç·¨æˆ
            </button>
            <button onclick="showCPUBattle()" style="width: 100%; margin: 10px 0; padding: 20px; font-size: 18px;">
                ğŸ¤– CPUå¯¾æˆ¦
            </button>
            <button onclick="showOnlineBattle()" style="width: 100%; margin: 10px 0; padding: 20px; font-size: 18px;">
                ğŸŒ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦
            </button>
            <button onclick="showSettings()" style="width: 100%; margin: 10px 0; padding: 20px; font-size: 18px;">
                âš™ï¸ è¨­å®š
            </button>
        </div>
        
        <!-- ãƒ‡ãƒƒã‚­ç·¨æˆç”»é¢ -->
        <div class="room-setup" id="deckBuilderScreen" style="display: none;">
            <h2>ğŸ“‹ ãƒ‡ãƒƒã‚­ç·¨æˆ</h2>
            
            <!-- ãƒ‡ãƒƒã‚­ã‚¹ãƒ­ãƒƒãƒˆé¸æŠ -->
            <div style="margin: 20px 0;">
                <button onclick="selectDeckSlot(1)" class="deck-slot-btn">ã‚¹ãƒ­ãƒƒãƒˆ1</button>
                <button onclick="selectDeckSlot(2)" class="deck-slot-btn">ã‚¹ãƒ­ãƒƒãƒˆ2</button>
                <button onclick="selectDeckSlot(3)" class="deck-slot-btn">ã‚¹ãƒ­ãƒƒãƒˆ3</button>
                <button onclick="selectDeckSlot(4)" class="deck-slot-btn">ã‚¹ãƒ­ãƒƒãƒˆ4</button>
                <button onclick="selectDeckSlot(5)" class="deck-slot-btn">ã‚¹ãƒ­ãƒƒãƒˆ5</button>
            </div>
            
            <div id="deckEditorArea" style="display: none;">
                <h3>ã‚¹ãƒ­ãƒƒãƒˆ<span id="currentSlot">1</span> ã‚’ç·¨é›†ä¸­</h3>
                <p>ãƒ‡ãƒƒã‚­æšæ•°: <span id="deckCardCount">0</span> / 40</p>
                
                <!-- ç¾åœ¨ã®ãƒ‡ãƒƒã‚­ -->
                <div style="margin: 20px 0; max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px;">
                    <h4 style="color: #ffcc00;">ç¾åœ¨ã®ãƒ‡ãƒƒã‚­</h4>
                    <div id="currentDeckList" style="font-size: 14px;"></div>
                </div>
                
                <!-- ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ -->
                <div style="margin: 20px 0;">
                    <h4 style="color: #ffcc00;">ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ </h4>
                    <select id="civilizationFilter" onchange="filterCards()" style="padding: 8px; margin-bottom: 10px; width: 100%;">
                        <option value="all">å…¨ã¦ã®æ–‡æ˜</option>
                        <option value="fire">ç«</option>
                        <option value="water">æ°´</option>
                        <option value="nature">è‡ªç„¶</option>
                        <option value="light">å…‰</option>
                        <option value="darkness">é—‡</option>
                    </select>
                    <div id="availableCardsList" style="max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px;"></div>
                </div>
                
                <button onclick="saveDeck()" style="width: 48%; margin: 5px 1%; background: #4CAF50;">ä¿å­˜</button>
                <button onclick="clearDeck()" style="width: 48%; margin: 5px 1%; background: #f44336;">ãƒ‡ãƒƒã‚­ã‚’ã‚¯ãƒªã‚¢</button>
            </div>
            
            <button onclick="backToMenu()" style="width: 100%; margin-top: 20px;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        </div>
        
        <!-- CPUå¯¾æˆ¦ç”»é¢ -->
        <div class="room-setup" id="cpuBattleScreen" style="display: none;">
            <h2>ğŸ¤– CPUå¯¾æˆ¦</h2>
            <p style="margin: 20px 0;">CPUå¯¾æˆ¦æ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™...</p>
            <button onclick="backToMenu()" style="width: 100%;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        </div>
        
        <!-- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ç”»é¢ -->
        <div class="room-setup" id="onlineBattleScreen" style="display: none;">
            <h2>ğŸŒ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦</h2>
            <input type="text" id="roomIdInput" placeholder="ãƒ«ãƒ¼ãƒ IDï¼ˆç©ºæ¬„ã§è‡ªå‹•ç”Ÿæˆï¼‰" style="margin: 20px 0;">
            <div>
                <button onclick="createRoom()" style="width: 48%; margin: 5px 1%;">ãƒ«ãƒ¼ãƒ ä½œæˆ</button>
                <button onclick="joinRoom()" style="width: 48%; margin: 5px 1%;">ãƒ«ãƒ¼ãƒ å‚åŠ </button>
            </div>
            <div id="roomInfo" style="margin-top: 20px; color: #ffcc00;"></div>
            <button id="readyBtn" onclick="ready()" style="width: 100%; margin-top: 20px; display: none;">æº–å‚™å®Œäº†</button>
            <button onclick="backToMenu()" style="width: 100%; margin-top: 10px;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        </div>
        
        <!-- è¨­å®šç”»é¢ -->
        <div class="room-setup" id="settingsScreen" style="display: none;">
            <h2>âš™ï¸ è¨­å®š</h2>
            <h3 style="margin-top: 20px; color: #ffcc00;">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</h3>
            <input type="text" id="settingsPlayerNameInput" placeholder="æ–°ã—ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å" style="margin: 10px 0;">
            <button onclick="changePlayerName()" style="width: 100%; margin-bottom: 20px;">å¤‰æ›´</button>
            <button onclick="backToMenu()" style="width: 100%;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        </div>
        
        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div class="game-field" id="gameField">
            <!-- ã‚¿ãƒ¼ãƒ³è¡¨ç¤º -->
            <div class="turn-indicator" id="turnIndicator">
                ã‚¿ãƒ¼ãƒ³1: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ã‚¿ãƒ¼ãƒ³
            </div>
            
            <!-- ç›¸æ‰‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div class="player-area p2" id="opponentArea">
                <div class="player-info">
                    <span class="player-name">ç›¸æ‰‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</span>
                    <div class="shields" id="opponentShields"></div>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-label">ãƒ‡ãƒƒã‚­:</span>
                            <span id="opponentDeckCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">æ‰‹æœ­:</span>
                            <span id="opponentHandCount">0</span>
                        </div>
                        <div class="stat-item clickable" onclick="viewMana(myPlayer === 'p1' ? 'p2' : 'p1')" title="ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒŠã‚’ç¢ºèª">
                            <span class="stat-label">ãƒãƒŠ:</span>
                            <span id="opponentManaCount">0</span>
                        </div>
                        <div class="stat-item clickable" onclick="viewGraveyard(myPlayer === 'p1' ? 'p2' : 'p1')" title="ã‚¯ãƒªãƒƒã‚¯ã§å¢“åœ°ã‚’ç¢ºèª">
                            <span class="stat-label">å¢“åœ°:</span>
                            <span id="opponentGraveyardCount">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="mana-zone clickable" id="opponentMana" onclick="viewMana(myPlayer === 'p1' ? 'p2' : 'p1')" title="ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒŠã‚’ç¢ºèª">
                    <small style="width: 100%; color: #ffcc00;">ãƒãƒŠã‚¾ãƒ¼ãƒ³ (ã‚¯ãƒªãƒƒã‚¯ã§ç¢ºèª)</small>
                </div>
                
                <div class="battle-zone" id="opponentBattleZone">
                    <h3>ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³</h3>
                </div>
            </div>
            
            <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <div class="controls">
                <button class="btn-charge" onclick="chargeMode()" id="chargeBtn">ãƒãƒŠãƒãƒ£ãƒ¼ã‚¸</button>
                <button class="btn-summon" onclick="summonMode()" id="summonBtn">å¬å–š</button>
                <button class="btn-spell" onclick="spellMode()" id="spellBtn">å‘ªæ–‡</button>
                <button class="btn-attack" onclick="attackMode()" id="attackBtn">æ”»æ’ƒ</button>
                <button class="btn-end" onclick="endTurn()" id="endTurnBtn">ã‚¿ãƒ¼ãƒ³çµ‚äº†</button>
            </div>
            
            <!-- è‡ªåˆ†ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div class="player-area p1" id="playerArea">
                <div class="battle-zone" id="playerBattleZone">
                    <h3>ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³</h3>
                </div>
                
                <div class="mana-zone clickable" id="playerMana" onclick="viewMana(myPlayer)" title="ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒŠã‚’ç¢ºèª">
                    <small style="width: 100%; color: #ffcc00;">ãƒãƒŠã‚¾ãƒ¼ãƒ³ (ã‚¯ãƒªãƒƒã‚¯ã§ç¢ºèª)</small>
                </div>
                
                <div class="player-info">
                    <span class="player-name">ã‚ãªãŸ</span>
                    <div class="shields" id="playerShields"></div>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-label">ãƒ‡ãƒƒã‚­:</span>
                            <span id="playerDeckCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">æ‰‹æœ­:</span>
                            <span id="playerHandCount">0</span>
                        </div>
                        <div class="stat-item clickable" onclick="viewMana(myPlayer)" title="ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒŠã‚’ç¢ºèª">
                            <span class="stat-label">ãƒãƒŠ:</span>
                            <span id="playerManaCount">0</span>
                        </div>
                        <div class="stat-item clickable" onclick="viewGraveyard(myPlayer)" title="ã‚¯ãƒªãƒƒã‚¯ã§å¢“åœ°ã‚’ç¢ºèª">
                            <span class="stat-label">å¢“åœ°:</span>
                            <span id="playerGraveyardCount">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ‰‹æœ­ -->
            <div class="hand-area">
                <h3>æ‰‹æœ­</h3>
                <div class="hand-cards" id="playerHand"></div>
            </div>
            
            <!-- ãƒ­ã‚° -->
            <div class="log-area">
                <h3>ã‚²ãƒ¼ãƒ ãƒ­ã‚°</h3>
                <div id="gameLog"></div>
            </div>
        </div>
        
        <!-- å‹åˆ©è¡¨ç¤º -->
        <div class="winner-display" id="winnerDisplay">
            <h2>ğŸ† å‹åˆ©ï¼ ğŸ†</h2>
            <p style="font-size: 24px; color: white;">ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</p>
            <button onclick="location.reload()" style="margin-top: 20px; padding: 15px 30px; font-size: 18px;">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
        </div>
        
        <!-- ã‚«ãƒ¼ãƒ‰è©³ç´°ãƒ‘ãƒãƒ« -->
        <div class="card-detail-panel" id="cardDetailPanel">
            <div class="card-detail-name" id="detailName"></div>
            <div class="card-detail-info" id="detailCost"></div>
            <div class="card-detail-info" id="detailCiv"></div>
            <div class="card-detail-info" id="detailRace"></div>
            <div class="card-detail-info" id="detailPower"></div>
            <div class="card-detail-info" id="detailAbility" style="margin-top: 15px; line-height: 1.6;"></div>
        </div>
        
        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒãƒŠãƒ»å¢“åœ°è¡¨ç¤ºç”¨ï¼‰ -->
        <div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <button class="modal-close" onclick="closeModal()">Ã—</button>
                <h3 class="modal-title" id="modalTitle"></h3>
                <div class="card-list" id="modalCardList"></div>
            </div>
        </div>
    </div>
    
    <script>
        const socket = io();
        let myPlayer = null;
        let roomId = null;
        let gameState = null;
        let currentMode = null;
        let selectedCard = null;
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¿å­˜ã•ã‚ŒãŸåå‰ã‚’è¡¨ç¤º
        window.onload = function() {
            checkPlayerName();
        };

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã®ç¢ºèªã¨ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã®è¡¨ç¤º
        function checkPlayerName() {
            const savedName = localStorage.getItem('duel_masters_player_name');
            if (savedName) {
                document.getElementById('continueGameBtn').style.display = 'block';
            } else {
                document.getElementById('startGameBtn').style.display = 'block';
            }
        }

        // æ–°ã—ãã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹
        function startNewGame() {
            hideAllScreens();
            document.getElementById('nameSetupScreen').style.display = 'block';
        }

        // ã‚²ãƒ¼ãƒ ã‚’ç¶šã‘ã‚‹
        function continueGame() {
            hideAllScreens();
            showMenu();
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’æ±ºå®š
        function confirmPlayerName() {
            const nameInput = document.getElementById('newPlayerNameInput');
            const name = nameInput.value.trim();
            if (name) {
                localStorage.setItem('duel_masters_player_name', name);
                hideAllScreens();
                showMenu();
            } else {
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            }
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã‚’è¡¨ç¤º
        function showMenu() {
            const savedName = localStorage.getItem('duel_masters_player_name');
            document.getElementById('menuPlayerName').textContent = `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: ${savedName}`;
            document.getElementById('menuScreen').style.display = 'block';
        }

        // å…¨ç”»é¢ã‚’éè¡¨ç¤º
        function hideAllScreens() {
            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('nameSetupScreen').style.display = 'none';
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('deckBuilderScreen').style.display = 'none';
            document.getElementById('cpuBattleScreen').style.display = 'none';
            document.getElementById('onlineBattleScreen').style.display = 'none';
            document.getElementById('settingsScreen').style.display = 'none';
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
        function backToMenu() {
            hideAllScreens();
            showMenu();
        }

        // ãƒ‡ãƒƒã‚­ç·¨æˆç”»é¢
        function showDeckBuilder() {
            hideAllScreens();
            document.getElementById('deckBuilderScreen').style.display = 'block';
            loadCardDatabase();
        }
        
        let allCards = [];
        let currentDeckSlot = null;
        let currentDeck = [];
        
        // ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã¿
        async function loadCardDatabase() {
            try {
                const response = await fetch('/api/cards');
                const data = await response.json();
                allCards = data.cards;
            } catch (e) {
                console.error('ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', e);
            }
        }
        
        // ãƒ‡ãƒƒã‚­ã‚¹ãƒ­ãƒƒãƒˆã‚’é¸æŠ
        function selectDeckSlot(slotNumber) {
            currentDeckSlot = slotNumber;
            document.getElementById('currentSlot').textContent = slotNumber;
            document.getElementById('deckEditorArea').style.display = 'block';
            
            // ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒƒã‚­ã‚’èª­ã¿è¾¼ã¿
            const savedDeck = localStorage.getItem(`deck_slot_${slotNumber}`);
            if (savedDeck) {
                currentDeck = JSON.parse(savedDeck);
            } else {
                currentDeck = [];
            }
            
            updateDeckDisplay();
            filterCards();
        }
        
        // ãƒ‡ãƒƒã‚­è¡¨ç¤ºã‚’æ›´æ–°
        function updateDeckDisplay() {
            document.getElementById('deckCardCount').textContent = currentDeck.length;
            
            const deckList = document.getElementById('currentDeckList');
            deckList.innerHTML = '';
            
            // ã‚«ãƒ¼ãƒ‰IDã”ã¨ã®æšæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            const cardCounts = {};
            currentDeck.forEach(cardId => {
                cardCounts[cardId] = (cardCounts[cardId] || 0) + 1;
            });
            
            // è¡¨ç¤º
            Object.entries(cardCounts).forEach(([cardId, count]) => {
                const card = allCards.find(c => c.id === cardId);
                if (card) {
                    const div = document.createElement('div');
                    div.style.cssText = 'padding: 5px; margin: 2px 0; background: rgba(255,255,255,0.1); border-radius: 5px; display: flex; justify-content: space-between; align-items: center;';
                    div.innerHTML = `
                        <span>${card.name} (ã‚³ã‚¹ãƒˆ: ${card.cost})</span>
                        <span>
                            <button onclick="removeCardFromDeck('${cardId}')" style="padding: 2px 8px; margin: 0 2px;">-</button>
                            <span style="margin: 0 5px;">${count}æš</span>
                        </span>
                    `;
                    deckList.appendChild(div);
                }
            });
        }
        
        // ã‚«ãƒ¼ãƒ‰ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function filterCards() {
            const filter = document.getElementById('civilizationFilter').value;
            const cardList = document.getElementById('availableCardsList');
            cardList.innerHTML = '';
            
            const filteredCards = allCards.filter(card => {
                if (filter === 'all') return true;
                return card.civ.includes(filter);
            });
            
            filteredCards.forEach(card => {
                const countInDeck = currentDeck.filter(id => id === card.id).length;
                const canAdd = currentDeck.length < 40 && countInDeck < 4;
                
                const civNames = {'fire': 'ç«', 'water': 'æ°´', 'nature': 'è‡ªç„¶', 'light': 'å…‰', 'darkness': 'é—‡'};
                const civText = card.civ.map(c => civNames[c] || c).join('/');
                
                const div = document.createElement('div');
                div.style.cssText = 'padding: 8px; margin: 5px 0; background: rgba(255,255,255,0.1); border-radius: 5px; display: flex; justify-content: space-between; align-items: center;';
                div.innerHTML = `
                    <div>
                        <div style="font-weight: bold;">${card.name}</div>
                        <div style="font-size: 12px;">ã‚³ã‚¹ãƒˆ: ${card.cost} | æ–‡æ˜: ${civText}</div>
                        <div style="font-size: 11px; color: #ccc;">ãƒ‡ãƒƒã‚­å†…: ${countInDeck}/4æš</div>
                    </div>
                    <button onclick="addCardToDeck('${card.id}')" ${!canAdd ? 'disabled' : ''} style="padding: 5px 15px;">
                        è¿½åŠ 
                    </button>
                `;
                cardList.appendChild(div);
            });
        }
        
        // ã‚«ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒƒã‚­ã«è¿½åŠ 
        function addCardToDeck(cardId) {
            const countInDeck = currentDeck.filter(id => id === cardId).length;
            if (currentDeck.length < 40 && countInDeck < 4) {
                currentDeck.push(cardId);
                updateDeckDisplay();
                filterCards();
            }
        }
        
        // ã‚«ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒƒã‚­ã‹ã‚‰å‰Šé™¤
        function removeCardFromDeck(cardId) {
            const index = currentDeck.indexOf(cardId);
            if (index > -1) {
                currentDeck.splice(index, 1);
                updateDeckDisplay();
                filterCards();
            }
        }
        
        // ãƒ‡ãƒƒã‚­ã‚’ä¿å­˜
        function saveDeck() {
            if (currentDeck.length !== 40) {
                alert(`ãƒ‡ãƒƒã‚­ã¯40æšã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç¾åœ¨: ${currentDeck.length}æš`);
                return;
            }
            
            localStorage.setItem(`deck_slot_${currentDeckSlot}`, JSON.stringify(currentDeck));
            alert(`ã‚¹ãƒ­ãƒƒãƒˆ${currentDeckSlot}ã«ãƒ‡ãƒƒã‚­ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼`);
        }
        
        // ãƒ‡ãƒƒã‚­ã‚’ã‚¯ãƒªã‚¢
        function clearDeck() {
            if (confirm('ãƒ‡ãƒƒã‚­ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                currentDeck = [];
                updateDeckDisplay();
                filterCards();
            }
        }

        // CPUå¯¾æˆ¦ç”»é¢
        function showCPUBattle() {
            hideAllScreens();
            document.getElementById('cpuBattleScreen').style.display = 'block';
        }

        // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ç”»é¢
        function showOnlineBattle() {
            hideAllScreens();
            document.getElementById('onlineBattleScreen').style.display = 'block';
        }

        // è¨­å®šç”»é¢
        function showSettings() {
            hideAllScreens();
            const savedName = localStorage.getItem('duel_masters_player_name');
            document.getElementById('settingsPlayerNameInput').value = savedName;
            document.getElementById('settingsScreen').style.display = 'block';
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å¤‰æ›´
        function changePlayerName() {
            const nameInput = document.getElementById('settingsPlayerNameInput');
            const name = nameInput.value.trim();
            if (name) {
                localStorage.setItem('duel_masters_player_name', name);
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å¤‰æ›´ã—ã¾ã—ãŸï¼');
                backToMenu();
            } else {
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            }
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’ä¿å­˜ï¼ˆæ—§æ©Ÿèƒ½ - äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
        function savePlayerName() {
            const nameInput = document.getElementById('playerNameInput');
            const name = nameInput.value.trim();
            if (name) {
                localStorage.setItem('duel_masters_player_name', name);
                displaySavedName(name);
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            } else {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            }
        }

        // ä¿å­˜ã•ã‚ŒãŸåå‰ã‚’èª­ã¿è¾¼ã¿ï¼ˆæ—§æ©Ÿèƒ½ - äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
        function loadPlayerName() {
            const savedName = localStorage.getItem('duel_masters_player_name');
            if (savedName) {
                document.getElementById('playerNameInput').value = savedName;
                displaySavedName(savedName);
            }
        }

        // ä¿å­˜ã•ã‚ŒãŸåå‰ã‚’è¡¨ç¤ºï¼ˆæ—§æ©Ÿèƒ½ - äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
        function displaySavedName(name) {
            const display = document.getElementById('savedNameDisplay');
            if (display) {
                display.textContent = `ä¿å­˜æ¸ˆã¿: ${name}`;
            }
        }
        
        // ã‚«ãƒ¼ãƒ‰è©³ç´°ã‚’è¡¨ç¤º
        function showCardDetail(card) {
            document.getElementById('detailName').textContent = card.name;
            document.getElementById('detailCost').textContent = `ã‚³ã‚¹ãƒˆ: ${card.cost}`;
            
            const civNames = {'fire': 'ç«', 'water': 'æ°´', 'nature': 'è‡ªç„¶', 'light': 'å…‰', 'darkness': 'é—‡'};
            const civText = card.civ.map(c => civNames[c] || c).join('/');
            document.getElementById('detailCiv').textContent = `æ–‡æ˜: ${civText}`;
            
            if (card.type === 'creature') {
                document.getElementById('detailRace').textContent = `ç¨®æ—: ${card.race}`;
                document.getElementById('detailPower').textContent = `ãƒ‘ãƒ¯ãƒ¼: ${card.power}`;
            } else {
                document.getElementById('detailRace').textContent = 'ç¨®æ—: -';
                document.getElementById('detailPower').textContent = 'ãƒ‘ãƒ¯ãƒ¼: -';
            }
            
            document.getElementById('detailAbility').textContent = card.ability || 'åŠ¹æœãªã—';
            document.getElementById('cardDetailPanel').classList.add('show');
        }
        
        // ã‚«ãƒ¼ãƒ‰è©³ç´°ã‚’éè¡¨ç¤º
        function hideCardDetail() {
            document.getElementById('cardDetailPanel').classList.remove('show');
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openModal(title, cards) {
            document.getElementById('modalTitle').textContent = title;
            const cardList = document.getElementById('modalCardList');
            cardList.innerHTML = '';
            
            cards.forEach(card => {
                const cardElement = createCardElement(card, 'modal');
                cardList.appendChild(cardElement);
            });
            
            document.getElementById('modalOverlay').classList.add('show');
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('show');
        }
        
        // ãƒãƒŠã‚¾ãƒ¼ãƒ³ã‚’è¡¨ç¤º
        function viewMana(player) {
            const manaCards = gameState.players[player].mana;
            openModal(`${player === myPlayer ? 'è‡ªåˆ†ã®' : 'ç›¸æ‰‹ã®'}ãƒãƒŠã‚¾ãƒ¼ãƒ³ (${manaCards.length}æš)`, manaCards);
        }
        
        // å¢“åœ°ã‚’è¡¨ç¤º
        function viewGraveyard(player) {
            const graveyardCards = gameState.players[player].graveyard;
            openModal(`${player === myPlayer ? 'è‡ªåˆ†ã®' : 'ç›¸æ‰‹ã®'}å¢“åœ° (${graveyardCards.length}æš)`, graveyardCards);
        }
        
        // ç”»é¢ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('cardDetailPanel');
            const cards = document.querySelectorAll('.card');
            let clickedCard = false;
            
            cards.forEach(card => {
                if (card.contains(e.target)) {
                    clickedCard = true;
                }
            });
            
            if (!clickedCard && !panel.contains(e.target)) {
                hideCardDetail();
            }
        });
        
        // ãƒ«ãƒ¼ãƒ ä½œæˆ
        function createRoom() {
            const input = document.getElementById('roomIdInput').value;
            socket.emit('create_room', { room_id: input || undefined });
        }
        
        // ãƒ«ãƒ¼ãƒ å‚åŠ 
        function joinRoom() {
            const input = document.getElementById('roomIdInput').value;
            if (!input) {
                alert('ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            socket.emit('join_room', { room_id: input });
        }
        
        // æº–å‚™å®Œäº†
        function ready() {
            socket.emit('ready', { player: myPlayer });
            document.getElementById('readyBtn').disabled = true;
            document.getElementById('roomInfo').innerHTML += '<br>æº–å‚™å®Œäº†ï¼ç›¸æ‰‹ã‚’å¾…ã£ã¦ã„ã¾ã™...';
        }
        
        // ãƒãƒŠãƒãƒ£ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰
        function chargeMode() {
            currentMode = 'charge';
            selectedCard = null;
            updateButtonStates();
        }
        
        // å¬å–šãƒ¢ãƒ¼ãƒ‰
        function summonMode() {
            currentMode = 'summon';
            selectedCard = null;
            updateButtonStates();
        }
        
        // å‘ªæ–‡ãƒ¢ãƒ¼ãƒ‰
        function spellMode() {
            currentMode = 'spell';
            selectedCard = null;
            updateButtonStates();
        }
        
        // æ”»æ’ƒãƒ¢ãƒ¼ãƒ‰
        function attackMode() {
            currentMode = 'attack';
            selectedCard = null;
            updateButtonStates();
        }
        
        // ã‚¿ãƒ¼ãƒ³çµ‚äº†
        function endTurn() {
            socket.emit('end_turn', { player: myPlayer });
            currentMode = null;
            selectedCard = null;
        }
        
        // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯
        function onCardClick(card, location) {
            if (gameState.turn !== myPlayer) return;
            
            if (currentMode === 'charge' && location === 'hand') {
                socket.emit('charge_mana', { player: myPlayer, card_id: card.id });
                currentMode = null;
            } else if (currentMode === 'summon' && location === 'hand' && card.type === 'creature') {
                socket.emit('summon_creature', { player: myPlayer, card_id: card.id });
                currentMode = null;
            } else if (currentMode === 'spell' && location === 'hand' && card.type === 'spell') {
                socket.emit('cast_spell', { player: myPlayer, card_id: card.id });
                currentMode = null;
            } else if (currentMode === 'attack' && location === 'battle') {
                socket.emit('attack', { player: myPlayer, creature_id: card.id, target: 'player' });
            }
            
            updateButtonStates();
        }
        
        // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
        function updateButtonStates() {
            const buttons = ['chargeBtn', 'summonBtn', 'spellBtn', 'attackBtn'];
            buttons.forEach(id => {
                document.getElementById(id).style.opacity = '1';
            });
            
            if (currentMode) {
                const activeBtn = currentMode + 'Btn';
                buttons.forEach(id => {
                    if (id !== activeBtn) {
                        document.getElementById(id).style.opacity = '0.5';
                    }
                });
            }
        }
        
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ç”»é¢ã«åæ˜ 
        function updateGameDisplay() {
            if (!gameState) return;
            
            const myData = gameState.players[myPlayer];
            const opData = gameState.players[myPlayer === 'p1' ? 'p2' : 'p1'];
            
            // ã‚¿ãƒ¼ãƒ³è¡¨ç¤º
            document.getElementById('turnIndicator').innerText = 
                `ã‚¿ãƒ¼ãƒ³${gameState.turn_count}: ${gameState.turn === myPlayer ? 'ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³' : 'ç›¸æ‰‹ã®ã‚¿ãƒ¼ãƒ³'}`;
            
            // ã‚·ãƒ¼ãƒ«ãƒ‰è¡¨ç¤º
            updateShields('playerShields', myData.shields);
            updateShields('opponentShields', opData.shields);
            
            // çµ±è¨ˆ
            document.getElementById('playerDeckCount').innerText = myData.deck_count;
            document.getElementById('playerHandCount').innerText = myData.hand_count;
            document.getElementById('playerManaCount').innerText = myData.mana.length;
            document.getElementById('playerGraveyardCount').innerText = myData.graveyard.length;
            document.getElementById('opponentDeckCount').innerText = opData.deck_count;
            document.getElementById('opponentHandCount').innerText = opData.hand_count;
            document.getElementById('opponentManaCount').innerText = opData.mana.length;
            document.getElementById('opponentGraveyardCount').innerText = opData.graveyard.length;
            
            // æ‰‹æœ­
            updateHand(myData.hand);
            
            // ãƒãƒŠã‚¾ãƒ¼ãƒ³
            updateMana('playerMana', myData.mana);
            updateMana('opponentMana', opData.mana);
            
            // ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³
            updateBattleZone('playerBattleZone', myData.battle_zone, myPlayer);
            updateBattleZone('opponentBattleZone', opData.battle_zone, myPlayer === 'p1' ? 'p2' : 'p1');
            
            // ãƒ­ã‚°
            updateLog(gameState.log);
            
            // å‹åˆ©åˆ¤å®š
            if (gameState.winner) {
                if (gameState.winner === myPlayer) {
                    document.getElementById('winnerDisplay').classList.add('show');
                } else {
                    document.getElementById('winnerDisplay').innerHTML = 
                        '<h2>ğŸ˜¢ æ•—åŒ— ğŸ˜¢</h2><p style="font-size: 24px; color: white;">æ¬¡ã¯é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼</p>';
                    document.getElementById('winnerDisplay').classList.add('show');
                }
            }
        }
        
        // ã‚·ãƒ¼ãƒ«ãƒ‰è¡¨ç¤º
        function updateShields(elementId, count) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const shield = document.createElement('div');
                shield.className = 'shield';
                shield.innerText = 'S';
                container.appendChild(shield);
            }
        }
        
        // æ‰‹æœ­è¡¨ç¤º
        function updateHand(hand) {
            const container = document.getElementById('playerHand');
            container.innerHTML = '';
            hand.forEach(card => {
                container.appendChild(createCardElement(card, 'hand'));
            });
        }
        
        // ãƒãƒŠã‚¾ãƒ¼ãƒ³è¡¨ç¤º
        function updateMana(elementId, mana) {
            const container = document.getElementById(elementId);
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä¿æŒ
            const header = container.querySelector('small');
            container.innerHTML = '';
            if (header) container.appendChild(header);
            
            mana.forEach(card => {
                const manaCard = document.createElement('div');
                let civClass = '';
                if (Array.isArray(card.civ)) {
                    civClass = card.civ[0];
                } else {
                    civClass = card.civ || card.civ_display || 'fire';
                }
                manaCard.className = `mana-card ${civClass} ${card.tapped ? 'tapped' : ''}`;
                manaCard.title = card.name;
                container.appendChild(manaCard);
            });
        }
        
        // ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³è¡¨ç¤º
        function updateBattleZone(elementId, creatures, owner) {
            const container = document.getElementById(elementId);
            const header = container.querySelector('h3');
            container.innerHTML = '';
            if (header) container.appendChild(header);
            
            creatures.forEach(creature => {
                container.appendChild(createCardElement(creature, 'battle', owner));
            });
        }
        
        // ã‚«ãƒ¼ãƒ‰è¦ç´ ä½œæˆ
        function createCardElement(card, location, owner) {
            const cardDiv = document.createElement('div');
            
            // å¤šè‰²ã‚«ãƒ¼ãƒ‰å¯¾å¿œ
            let civClass = '';
            if (Array.isArray(card.civ)) {
                if (card.civ.length > 2) {
                    civClass = 'multi';
                } else {
                    civClass = `multi-${card.civ.join('-')}`;
                }
            } else {
                civClass = card.civ || card.civ_display || 'fire';
            }
            
            cardDiv.className = `card ${civClass}`;
            if (card.tapped) cardDiv.classList.add('tapped');
            if (card.summoning_sick) cardDiv.classList.add('summoning-sick');
            
            // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯æ™‚ã«è©³ç´°è¡¨ç¤ºã¨ã‚²ãƒ¼ãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸¡æ–¹ã‚’å‡¦ç†
            cardDiv.onclick = (e) => {
                e.stopPropagation();
                showCardDetail(card);
                onCardClick(card, location);
            };
            
            // Sãƒ»ãƒˆãƒªã‚¬ãƒ¼ãƒãƒ¼ã‚¯
            const triggerMark = card.shield_trigger ? '<span style="color: #ffcc00; font-weight: bold;">âš¡Sãƒ»ãƒˆãƒªã‚¬ãƒ¼</span><br>' : '';
            
            // ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼è¡¨ç¤º
            let breakerText = '';
            if (card.breaker && card.breaker > 1) {
                breakerText = `<div style="position: absolute; top: -8px; right: -8px; background: #ff0000; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid #fff;">${'âš”ï¸'.repeat(card.breaker)}</div>`;
            }
            
            cardDiv.innerHTML = `
                <div class="card-cost">${card.cost}</div>
                ${breakerText}
                <div class="card-name">${card.name}</div>
                <div class="card-race">${card.race || card.type}</div>
                <div class="card-ability">${triggerMark}${card.ability || 'åŠ¹æœãªã—'}</div>
                ${card.type === 'creature' ? `<div class="card-power">${card.power}</div>` : ''}
            `;
            
            return cardDiv;
        }
        
        // ãƒ­ã‚°æ›´æ–°
        function updateLog(log) {
            const container = document.getElementById('gameLog');
            container.innerHTML = '';
            log.forEach(entry => {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerText = entry;
                container.appendChild(logEntry);
            });
            container.scrollTop = container.scrollHeight;
        }
        
        // Socket.IOã‚¤ãƒ™ãƒ³ãƒˆ
        socket.on('room_created', (data) => {
            roomId = data.room_id;
            myPlayer = data.player;
            document.getElementById('roomInfo').innerHTML = `ãƒ«ãƒ¼ãƒ ID: <strong>${roomId}</strong><br>ã‚ãªãŸã¯${myPlayer}ã§ã™`;
            document.getElementById('readyBtn').style.display = 'block';
        });
        
        socket.on('room_joined', (data) => {
            roomId = data.room_id;
            myPlayer = data.player;
            document.getElementById('roomInfo').innerHTML = `ãƒ«ãƒ¼ãƒ ID: <strong>${roomId}</strong><br>ã‚ãªãŸã¯${myPlayer}ã§ã™`;
            document.getElementById('readyBtn').style.display = 'block';
        });
        
        socket.on('game_start', (data) => {
            gameState = data;
            hideAllScreens();
            document.getElementById('gameField').classList.add('active');
            updateGameDisplay();
        });
        
        socket.on('game_update', (data) => {
            gameState = data;
            updateGameDisplay();
        });
        
        socket.on('error', (data) => {
            alert(data.msg);
        });
    </script>
</body>
</html>
