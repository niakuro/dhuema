<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éá„É•„Ç®„É´„Éû„Çπ„Çø„Éº„Ç∫</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            overflow-x: hidden;
        }
        
        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä */
        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .header h1 {
            font-size: 36px;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
            margin-bottom: 10px;
        }
        
        /* „É´„Éº„É†Ë®≠ÂÆö */
        .room-setup {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            margin: 50px auto;
            text-align: center;
        }
        
        .room-setup input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ffcc00;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }
        
        .room-setup button {
            width: 48%;
            padding: 12px;
            margin: 5px 1%;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            color: #000;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .room-setup button:hover {
            transform: scale(1.05);
        }
        
        /* „Ç≤„Éº„É†„Éï„Ç£„Éº„É´„Éâ */
        .game-field {
            display: none;
        }
        
        .game-field.active {
            display: block;
        }
        
        /* „Éó„É¨„Ç§„É§„Éº„Ç®„É™„Ç¢ */
        .player-area {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border: 3px solid;
        }
        
        .player-area.p1 { border-color: #3498db; }
        .player-area.p2 { border-color: #e74c3c; }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
        }
        
        .player-name {
            font-size: 24px;
            font-weight: bold;
        }
        
        .shields {
            display: flex;
            gap: 5px;
        }
        
        .shield {
            width: 30px;
            height: 40px;
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            border: 2px solid #fff;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        /* „Éê„Éà„É´„Çæ„Éº„É≥ */
        .battle-zone {
            min-height: 200px;
            background: rgba(50, 50, 50, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }
        
        .battle-zone h3 {
            width: 100%;
            margin-bottom: 10px;
            color: #ffcc00;
        }
        
        /* „Éû„Éä„Çæ„Éº„É≥ */
        .mana-zone {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            background: rgba(0, 100, 0, 0.2);
            border-radius: 8px;
            min-height: 80px;
            margin: 10px 0;
        }
        
        /* ÊâãÊú≠„Ç®„É™„Ç¢ */
        .hand-area {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            min-height: 200px;
        }
        
        .hand-area h3 {
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .hand-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        /* „Ç´„Éº„Éâ„Çπ„Çø„Ç§„É´ */
        .card {
            width: 120px;
            height: 180px;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            border: 3px solid;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }
        
        .card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
        }
        
        .card.fire {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            border-color: #ff0000;
        }
        
        .card.water {
            background: linear-gradient(135deg, #4444ff 0%, #0000cc 100%);
            border-color: #0000ff;
        }
        
        .card.nature {
            background: linear-gradient(135deg, #44ff44 0%, #00cc00 100%);
            border-color: #00ff00;
        }
        
        .card.light {
            background: linear-gradient(135deg, #ffff44 0%, #cccc00 100%);
            border-color: #ffff00;
        }
        
        .card.darkness {
            background: linear-gradient(135deg, #8844ff 0%, #4400cc 100%);
            border-color: #6600ff;
        }
        
        .card-cost {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 35px;
            height: 35px;
            background: #ffcc00;
            border: 3px solid #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .card-name {
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            margin-bottom: 5px;
            text-align: center;
        }
        
        .card-race {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            margin-bottom: 5px;
        }
        
        .card-ability {
            font-size: 8px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px;
            border-radius: 5px;
            height: 70px;
            overflow-y: auto;
            margin: 5px 0;
        }
        
        .card-power {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }
        
        .card.tapped {
            transform: rotate(90deg);
            opacity: 0.7;
        }
        
        .card.summoning-sick {
            opacity: 0.6;
            filter: grayscale(0.5);
        }
        
        /* „Éû„Éä„Ç´„Éº„ÉâÔºàÂ∞è„Åï„ÅèË°®Á§∫Ôºâ */
        .mana-card {
            width: 40px;
            height: 60px;
            border-radius: 5px;
            border: 2px solid;
            position: relative;
            transition: transform 0.2s;
        }
        
        .mana-card:hover {
            transform: scale(1.2);
        }
        
        .mana-card.tapped {
            opacity: 0.5;
        }
        
        /* „Ç≥„É≥„Éà„É≠„Éº„É´„Éë„Éç„É´ */
        .controls {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .controls button {
            padding: 12px 25px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-charge {
            background: linear-gradient(135deg, #44ff44, #00cc00);
            color: #000;
        }
        
        .btn-summon {
            background: linear-gradient(135deg, #4444ff, #0000cc);
            color: white;
        }
        
        .btn-spell {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
        }
        
        .btn-attack {
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            color: #000;
        }
        
        .btn-end {
            background: linear-gradient(135deg, #888888, #555555);
            color: white;
        }
        
        .controls button:hover {
            transform: scale(1.1);
        }
        
        .controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* „É≠„Ç∞„Ç®„É™„Ç¢ */
        .log-area {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .log-area h3 {
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .log-entry {
            padding: 5px;
            border-left: 3px solid #ffcc00;
            margin: 5px 0;
            padding-left: 10px;
            color: #fff;
        }
        
        /* „Çø„Éº„É≥Ë°®Á§∫ */
        .turn-indicator {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            border-radius: 10px;
            margin: 10px 0;
            font-size: 24px;
            font-weight: bold;
            color: #000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }
        
        /* ÂãùÂà©Ë°®Á§∫ */
        .winner-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            z-index: 1000;
            border: 5px solid #ffcc00;
            display: none;
        }
        
        .winner-display.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        
        .winner-display h2 {
            font-size: 48px;
            color: #ffcc00;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 204, 0, 0.8);
        }
        
        /* „Çπ„ÇØ„É≠„Éº„É´„Éê„Éº */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }
        
        ::-webkit-scrollbar-thumb {
            background: #ffcc00;
            border-radius: 4px;
        }
        
        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
        @media (max-width: 768px) {
            .card {
                width: 90px;
                height: 135px;
            }
            
            .controls button {
                padding: 8px 15px;
                font-size: 14px;
            }
        }
        
        .selected-card {
            border: 4px solid #ffcc00 !important;
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.8) !important;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .stat-label {
            color: #ffcc00;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>‚öîÔ∏è „Éá„É•„Ç®„É´„Éû„Çπ„Çø„Éº„Ç∫ ‚öîÔ∏è</h1>
            <p>„Ç´„Éº„Éâ„Ç≤„Éº„É†„ÅÆ‰∏ñÁïå„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ</p>
        </div>
        
        <!-- „É´„Éº„É†Ë®≠ÂÆöÁîªÈù¢ -->
        <div class="room-setup" id="roomSetup">
            <h2>„É´„Éº„É†Ë®≠ÂÆö</h2>
            <input type="text" id="roomIdInput" placeholder="„É´„Éº„É†IDÔºàÁ©∫Ê¨Ñ„ÅßËá™ÂãïÁîüÊàêÔºâ">
            <div>
                <button onclick="createRoom()">„É´„Éº„É†‰ΩúÊàê</button>
                <button onclick="joinRoom()">„É´„Éº„É†ÂèÇÂä†</button>
            </div>
            <div id="roomInfo" style="margin-top: 20px; color: #ffcc00;"></div>
            <button id="readyBtn" onclick="ready()" style="width: 100%; margin-top: 20px; display: none;">Ê∫ñÂÇôÂÆå‰∫Ü</button>
        </div>
        
        <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
        <div class="game-field" id="gameField">
            <!-- „Çø„Éº„É≥Ë°®Á§∫ -->
            <div class="turn-indicator" id="turnIndicator">
                „Çø„Éº„É≥1: „Éó„É¨„Ç§„É§„Éº1„ÅÆ„Çø„Éº„É≥
            </div>
            
            <!-- Áõ∏Êâã„Éó„É¨„Ç§„É§„Éº„Ç®„É™„Ç¢ -->
            <div class="player-area p2" id="opponentArea">
                <div class="player-info">
                    <span class="player-name">Áõ∏Êâã„Éó„É¨„Ç§„É§„Éº</span>
                    <div class="shields" id="opponentShields"></div>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-label">„Éá„ÉÉ„Ç≠:</span>
                            <span id="opponentDeckCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ÊâãÊú≠:</span>
                            <span id="opponentHandCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">„Éû„Éä:</span>
                            <span id="opponentManaCount">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="mana-zone" id="opponentMana">
                    <small style="width: 100%; color: #ffcc00;">„Éû„Éä„Çæ„Éº„É≥</small>
                </div>
                
                <div class="battle-zone" id="opponentBattleZone">
                    <h3>„Éê„Éà„É´„Çæ„Éº„É≥</h3>
                </div>
            </div>
            
            <!-- „Ç≥„É≥„Éà„É≠„Éº„É´ -->
            <div class="controls">
                <button class="btn-charge" onclick="chargeMode()" id="chargeBtn">„Éû„Éä„ÉÅ„É£„Éº„Ç∏</button>
                <button class="btn-summon" onclick="summonMode()" id="summonBtn">Âè¨Âñö</button>
                <button class="btn-spell" onclick="spellMode()" id="spellBtn">Âë™Êñá</button>
                <button class="btn-attack" onclick="attackMode()" id="attackBtn">ÊîªÊíÉ</button>
                <button class="btn-end" onclick="endTurn()" id="endTurnBtn">„Çø„Éº„É≥ÁµÇ‰∫Ü</button>
            </div>
            
            <!-- Ëá™ÂàÜ„ÅÆ„Éó„É¨„Ç§„É§„Éº„Ç®„É™„Ç¢ -->
            <div class="player-area p1" id="playerArea">
                <div class="battle-zone" id="playerBattleZone">
                    <h3>„Éê„Éà„É´„Çæ„Éº„É≥</h3>
                </div>
                
                <div class="mana-zone" id="playerMana">
                    <small style="width: 100%; color: #ffcc00;">„Éû„Éä„Çæ„Éº„É≥</small>
                </div>
                
                <div class="player-info">
                    <span class="player-name">„ÅÇ„Å™„Åü</span>
                    <div class="shields" id="playerShields"></div>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-label">„Éá„ÉÉ„Ç≠:</span>
                            <span id="playerDeckCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ÊâãÊú≠:</span>
                            <span id="playerHandCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">„Éû„Éä:</span>
                            <span id="playerManaCount">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÊâãÊú≠ -->
            <div class="hand-area">
                <h3>ÊâãÊú≠</h3>
                <div class="hand-cards" id="playerHand"></div>
            </div>
            
            <!-- „É≠„Ç∞ -->
            <div class="log-area">
                <h3>„Ç≤„Éº„É†„É≠„Ç∞</h3>
                <div id="gameLog"></div>
            </div>
        </div>
        
        <!-- ÂãùÂà©Ë°®Á§∫ -->
        <div class="winner-display" id="winnerDisplay">
            <h2>üèÜ ÂãùÂà©ÔºÅ üèÜ</h2>
            <p style="font-size: 24px; color: white;">„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ</p>
            <button onclick="location.reload()" style="margin-top: 20px; padding: 15px 30px; font-size: 18px;">„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§</button>
        </div>
    </div>
    
    <script>
        const socket = io();
        let myPlayer = null;
        let roomId = null;
        let gameState = null;
        let currentMode = null;
        let selectedCard = null;
        
        // „É´„Éº„É†‰ΩúÊàê
        function createRoom() {
            const input = document.getElementById('roomIdInput').value;
            socket.emit('create_room', { room_id: input || undefined });
        }
        
        // „É´„Éº„É†ÂèÇÂä†
        function joinRoom() {
            const input = document.getElementById('roomIdInput').value;
            if (!input) {
                alert('„É´„Éº„É†ID„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            socket.emit('join_room', { room_id: input });
        }
        
        // Ê∫ñÂÇôÂÆå‰∫Ü
        function ready() {
            socket.emit('ready', { player: myPlayer });
            document.getElementById('readyBtn').disabled = true;
            document.getElementById('roomInfo').innerHTML += '<br>Ê∫ñÂÇôÂÆå‰∫ÜÔºÅÁõ∏Êâã„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô...';
        }
        
        // „Éû„Éä„ÉÅ„É£„Éº„Ç∏„É¢„Éº„Éâ
        function chargeMode() {
            currentMode = 'charge';
            selectedCard = null;
            updateButtonStates();
        }
        
        // Âè¨Âñö„É¢„Éº„Éâ
        function summonMode() {
            currentMode = 'summon';
            selectedCard = null;
            updateButtonStates();
        }
        
        // Âë™Êñá„É¢„Éº„Éâ
        function spellMode() {
            currentMode = 'spell';
            selectedCard = null;
            updateButtonStates();
        }
        
        // ÊîªÊíÉ„É¢„Éº„Éâ
        function attackMode() {
            currentMode = 'attack';
            selectedCard = null;
            updateButtonStates();
        }
        
        // „Çø„Éº„É≥ÁµÇ‰∫Ü
        function endTurn() {
            socket.emit('end_turn', { player: myPlayer });
            currentMode = null;
            selectedCard = null;
        }
        
        // „Ç´„Éº„Éâ„ÇØ„É™„ÉÉ„ÇØ
        function onCardClick(card, location) {
            if (gameState.turn !== myPlayer) return;
            
            if (currentMode === 'charge' && location === 'hand') {
                socket.emit('charge_mana', { player: myPlayer, card_id: card.id });
                currentMode = null;
            } else if (currentMode === 'summon' && location === 'hand' && card.type === 'creature') {
                socket.emit('summon_creature', { player: myPlayer, card_id: card.id });
                currentMode = null;
            } else if (currentMode === 'spell' && location === 'hand' && card.type === 'spell') {
                socket.emit('cast_spell', { player: myPlayer, card_id: card.id });
                currentMode = null;
            } else if (currentMode === 'attack' && location === 'battle') {
                socket.emit('attack', { player: myPlayer, creature_id: card.id, target: 'player' });
            }
            
            updateButtonStates();
        }
        
        // „Éú„Çø„É≥Áä∂ÊÖãÊõ¥Êñ∞
        function updateButtonStates() {
            const buttons = ['chargeBtn', 'summonBtn', 'spellBtn', 'attackBtn'];
            buttons.forEach(id => {
                document.getElementById(id).style.opacity = '1';
            });
            
            if (currentMode) {
                const activeBtn = currentMode + 'Btn';
                buttons.forEach(id => {
                    if (id !== activeBtn) {
                        document.getElementById(id).style.opacity = '0.5';
                    }
                });
            }
        }
        
        // „Ç≤„Éº„É†Áä∂ÊÖã„ÇíÁîªÈù¢„Å´ÂèçÊò†
        function updateGameDisplay() {
            if (!gameState) return;
            
            const myData = gameState.players[myPlayer];
            const opData = gameState.players[myPlayer === 'p1' ? 'p2' : 'p1'];
            
            // „Çø„Éº„É≥Ë°®Á§∫
            document.getElementById('turnIndicator').innerText = 
                `„Çø„Éº„É≥${gameState.turn_count}: ${gameState.turn === myPlayer ? '„ÅÇ„Å™„Åü„ÅÆ„Çø„Éº„É≥' : 'Áõ∏Êâã„ÅÆ„Çø„Éº„É≥'}`;
            
            // „Ç∑„Éº„É´„ÉâË°®Á§∫
            updateShields('playerShields', myData.shields);
            updateShields('opponentShields', opData.shields);
            
            // Áµ±Ë®à
            document.getElementById('playerDeckCount').innerText = myData.deck_count;
            document.getElementById('playerHandCount').innerText = myData.hand_count;
            document.getElementById('playerManaCount').innerText = myData.mana.length;
            document.getElementById('opponentDeckCount').innerText = opData.deck_count;
            document.getElementById('opponentHandCount').innerText = opData.hand_count;
            document.getElementById('opponentManaCount').innerText = opData.mana.length;
            
            // ÊâãÊú≠
            updateHand(myData.hand);
            
            // „Éû„Éä„Çæ„Éº„É≥
            updateMana('playerMana', myData.mana);
            updateMana('opponentMana', opData.mana);
            
            // „Éê„Éà„É´„Çæ„Éº„É≥
            updateBattleZone('playerBattleZone', myData.battle_zone, myPlayer);
            updateBattleZone('opponentBattleZone', opData.battle_zone, myPlayer === 'p1' ? 'p2' : 'p1');
            
            // „É≠„Ç∞
            updateLog(gameState.log);
            
            // ÂãùÂà©Âà§ÂÆö
            if (gameState.winner) {
                if (gameState.winner === myPlayer) {
                    document.getElementById('winnerDisplay').classList.add('show');
                } else {
                    document.getElementById('winnerDisplay').innerHTML = 
                        '<h2>üò¢ ÊïóÂåó üò¢</h2><p style="font-size: 24px; color: white;">Ê¨°„ÅØÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ</p>';
                    document.getElementById('winnerDisplay').classList.add('show');
                }
            }
        }
        
        // „Ç∑„Éº„É´„ÉâË°®Á§∫
        function updateShields(elementId, count) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const shield = document.createElement('div');
                shield.className = 'shield';
                shield.innerText = 'S';
                container.appendChild(shield);
            }
        }
        
        // ÊâãÊú≠Ë°®Á§∫
        function updateHand(hand) {
            const container = document.getElementById('playerHand');
            container.innerHTML = '';
            hand.forEach(card => {
                container.appendChild(createCardElement(card, 'hand'));
            });
        }
        
        // „Éû„Éä„Çæ„Éº„É≥Ë°®Á§∫
        function updateMana(elementId, mana) {
            const container = document.getElementById(elementId);
            // „Éò„ÉÉ„ÉÄ„Éº„Çí‰øùÊåÅ
            const header = container.querySelector('small');
            container.innerHTML = '';
            if (header) container.appendChild(header);
            
            mana.forEach(card => {
                const manaCard = document.createElement('div');
                manaCard.className = `mana-card ${card.civ} ${card.tapped ? 'tapped' : ''}`;
                container.appendChild(manaCard);
            });
        }
        
        // „Éê„Éà„É´„Çæ„Éº„É≥Ë°®Á§∫
        function updateBattleZone(elementId, creatures, owner) {
            const container = document.getElementById(elementId);
            const header = container.querySelector('h3');
            container.innerHTML = '';
            if (header) container.appendChild(header);
            
            creatures.forEach(creature => {
                container.appendChild(createCardElement(creature, 'battle', owner));
            });
        }
        
        // „Ç´„Éº„ÉâË¶ÅÁ¥†‰ΩúÊàê
        function createCardElement(card, location, owner) {
            const cardDiv = document.createElement('div');
            cardDiv.className = `card ${card.civ}`;
            if (card.tapped) cardDiv.classList.add('tapped');
            if (card.summoning_sick) cardDiv.classList.add('summoning-sick');
            
            cardDiv.onclick = () => onCardClick(card, location);
            
            cardDiv.innerHTML = `
                <div class="card-cost">${card.cost}</div>
                <div class="card-name">${card.name}</div>
                <div class="card-race">${card.race || card.type}</div>
                <div class="card-ability">${card.ability || 'ÂäπÊûú„Å™„Åó'}</div>
                ${card.type === 'creature' ? `<div class="card-power">${card.power}</div>` : ''}
            `;
            
            return cardDiv;
        }
        
        // „É≠„Ç∞Êõ¥Êñ∞
        function updateLog(log) {
            const container = document.getElementById('gameLog');
            container.innerHTML = '';
            log.forEach(entry => {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerText = entry;
                container.appendChild(logEntry);
            });
            container.scrollTop = container.scrollHeight;
        }
        
        // Socket.IO„Ç§„Éô„É≥„Éà
        socket.on('room_created', (data) => {
            roomId = data.room_id;
            myPlayer = data.player;
            document.getElementById('roomInfo').innerHTML = `„É´„Éº„É†ID: <strong>${roomId}</strong><br>„ÅÇ„Å™„Åü„ÅØ${myPlayer}„Åß„Åô`;
            document.getElementById('readyBtn').style.display = 'block';
        });
        
        socket.on('room_joined', (data) => {
            roomId = data.room_id;
            myPlayer = data.player;
            document.getElementById('roomInfo').innerHTML = `„É´„Éº„É†ID: <strong>${roomId}</strong><br>„ÅÇ„Å™„Åü„ÅØ${myPlayer}„Åß„Åô`;
            document.getElementById('readyBtn').style.display = 'block';
        });
        
        socket.on('game_start', (data) => {
            gameState = data;
            document.getElementById('roomSetup').style.display = 'none';
            document.getElementById('gameField').classList.add('active');
            updateGameDisplay();
        });
        
        socket.on('game_update', (data) => {
            gameState = data;
            updateGameDisplay();
        });
        
        socket.on('error', (data) => {
            alert(data.msg);
        });
    </script>
</body>
</html>
